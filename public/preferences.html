<!doctype html>
<html lang="en">
<head>
  <script>window.API_BASE = '';</script>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>iTRUEMATCH â€¢ Preferences</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="auth.css">
  <link rel="stylesheet" href="preferences.css?v=6">
  <link rel="stylesheet" href="responsive.css">

  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>

<body class="tm-dark">
  <canvas id="tm-bg-canvas" aria-hidden="true"></canvas>

  <nav class="auth-top-nav">
    <a href="index.html" class="nav-brand">
      <img src="assets/images/truematch-mark.png" alt="Logo" />
      <span>iTRUEMATCH</span>
    </a>

    <div class="nav-actions">
      <a href="#" class="nav-login-link nav-logout-link">LOG OUT</a>
    </div>
  </nav>

  <div class="split-layout">
    <div class="unified-card pref-card-override">

      <!-- LEFT: Timeline -->
      <div class="auth-visual-side pref-visual-side">
        <div class="timeline-wrapper">
          <h2 class="timeline-title">Setup Profile</h2>

          <div class="timeline-track">
            <div class="track-line" style="bottom: 40px;"></div>

            <div class="timeline-node done">
              <div class="node-circle" aria-hidden="true">
                <span class="node-icon">âœ“</span>
              </div>
              <div class="node-text">
                <h3>Account</h3>
                <p>Credentials secure</p>
              </div>
            </div>

            <div class="timeline-node active">
              <div class="node-circle" aria-hidden="true">
                <span class="node-icon">2</span>
              </div>
              <div class="node-text">
                <h3>Preferences</h3>
                <p>Find your type</p>
              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- RIGHT: Form -->
      <div class="auth-form-side pref-form-side">
        <div class="form-scroll-container">

          <div class="auth-header" style="margin-top: 20px;">
            <h1>Set your preferences</h1>
            <p>City, age range, and ethnicity.</p>
          </div>

          <form id="preferencesForm" autocomplete="on">

            <!-- Your profile (required) -->
            <div class="profile-section stagger-0">
              <h3 class="section-label">Your profile</h3>

              <div class="input-row stagger-2">
                <div class="pref-group">
                  <label class="static-label" for="profileAge">Your age</label>
                  <input class="text-input" type="number" id="profileAge" name="profileAge" min="18" max="80" required placeholder="e.g. 21" inputmode="numeric" />
                </div>

                <div class="pref-group">
                  <label class="static-label" for="profileCity">Your city</label>
                  <input class="text-input" type="text" id="profileCity" name="profileCity" required placeholder="e.g. Marbella" autocomplete="address-level2" />
                </div>
              </div>

              <div class="avatar-upload">
                <label class="static-label">Profile picture</label>

                <div class="avatar-row">
                  <div class="avatar-preview" id="avatarPreview" aria-hidden="true">
                    <img id="avatarPreviewImg" alt="Profile picture preview" />
                    <div class="avatar-placeholder" id="avatarPlaceholder">Upload</div>
                  </div>

                  <div class="avatar-actions">
                    <input type="file" id="avatarFile" name="avatarFile" accept="image/*" />
                    <label class="btn btn-secondary avatar-btn" for="avatarFile" id="avatarBtn">Choose photo</label>
                    <div class="file-name" id="avatarFileName">No file chosen</div>
                    <div class="hint">JPG/PNG. We&apos;ll auto-crop and compress.</div>
                  </div>
                </div>
              </div>
            </div>

            <div class="input-group stagger-1">
              <input type="text" id="city" name="city" required placeholder=" " />
              <label for="city">Preferred city (e.g. Marbella)</label>
            </div>

            <div class="input-row">
              <div class="pref-group">
                <label class="static-label">Age Range</label>
                <div class="age-range-capsule">
                  <input type="number" id="ageMin" name="ageMin" placeholder="18" value="25" min="18" max="80" required inputmode="numeric">
                  <span class="sep">-</span>
                  <input type="number" id="ageMax" name="ageMax" placeholder="80" value="35" min="18" max="80" required inputmode="numeric">
                </div>
              </div>

              <div class="pref-group">
                <label class="static-label">Ethnicity</label>
                <div class="select-wrapper">
                  <select id="ethnicity" name="ethnicity" required>
                    <option value="" disabled selected>Choose one</option>
                    <option value="african">African</option>
                    <option value="asian">Asian</option>
                    <option value="caucasian">Caucasian</option>
                    <option value="hispanic">Hispanic / Latino</option>
                    <option value="middle-eastern">Middle Eastern</option>
                    <option value="mixed">Mixed</option>
                    <option value="other">Other</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="pref-group stagger-3">
              <label class="static-label">Looking for</label>
              <div class="radio-cards">
                <label class="radio-card">
                  <input type="radio" name="lookingFor" value="women" checked>
                  <div class="card-content">Women</div>
                </label>
                <label class="radio-card">
                  <input type="radio" name="lookingFor" value="men">
                  <div class="card-content">Men</div>
                </label>
              </div>
            </div>

            <section id="advancedPrefsSection" class="advanced-section hidden" style="display:none;">
              <div class="lock-overlay">
                <span class="lock-icon">ðŸ”’</span>
                <span>Advanced Filters (VIP)</span>
              </div>

              <div class="advanced-content">
                <h3 class="section-label">Advanced filters</h3>

                <div class="pref-group">
                  <div class="select-wrapper">
                    <select id="intent" name="intent">
                      <option value="">No preference</option>
                      <option value="long-term">Long-term relationship</option>
                      <option value="short-term">Short-term / casual</option>
                      <option value="open">Open to see what happens</option>
                    </select>
                  </div>
                </div>

                <div class="pref-group">
                  <textarea id="dealbreakers" name="dealbreakers" rows="3" placeholder="Habits, values or lifestyles you absolutely cannot accept."></textarea>
                </div>

                <div class="pref-field">
                  <p class="static-label" style="margin-bottom:10px;">Shared values you care about</p>
                  <div class="tags-group">
                    <label><input type="checkbox" name="sharedValues" value="family"> Family-focused</label>
                    <label><input type="checkbox" name="sharedValues" value="career"> Career & ambition</label>
                    <label><input type="checkbox" name="sharedValues" value="faith"> Faith / spirituality</label>
                    <label><input type="checkbox" name="sharedValues" value="fitness"> Health & fitness</label>
                    <label><input type="checkbox" name="sharedValues" value="travel"> Travel & experiences</label>
                  </div>
                </div>
              </div>
            </section>

            <button class="btn btn-primary" type="submit">Save & Continue</button>
            <div style="height: 30px;"></div>
          </form>

        </div>
      </div>

    </div>
  </div>

  <div id="tm_loader_overlay" style="display:none;"><div class="loader-spinner"></div></div>

  <script>
    (() => {
      const canvas = document.getElementById('tm-bg-canvas');
      if (!canvas) return;
      const ctx = canvas.getContext('2d', { alpha: true });
      if (!ctx) return;
      const reduceMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const mouse = { x: 0, y: 0, active: false };
      const particles = [];
      let cw = 0, ch = 0, dpr = 1, raf = null;
      const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
      function pickCount() { return clamp(Math.floor((window.innerWidth * window.innerHeight) / 22000) + 28, 38, 90); }
      function resize() {
        dpr = Math.min(window.devicePixelRatio || 1, 2);
        cw = window.innerWidth; ch = window.innerHeight;
        canvas.width = Math.floor(cw * dpr); canvas.height = Math.floor(ch * dpr);
        canvas.style.width = cw + 'px'; canvas.style.height = ch + 'px';
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        init(); draw(true);
      }
      function init() {
        particles.length = 0; const count = pickCount();
        for (let i = 0; i < count; i++) {
          particles.push({ x: Math.random() * cw, y: Math.random() * ch, vx: (Math.random() - 0.5) * 0.35, vy: (Math.random() - 0.5) * 0.35, r: 1 + Math.random() * 1.3 });
        }
      }
      function step() {
        for (const p of particles) {
          p.x += p.vx; p.y += p.vy;
          if (p.x < 0 || p.x > cw) p.vx *= -1; if (p.y < 0 || p.y > ch) p.vy *= -1;
          if (mouse.active) {
            const dx = p.x - mouse.x; const dy = p.y - mouse.y; const dist2 = dx * dx + dy * dy;
            if (dist2 < 48400 && dist2 > 0.001) {
              const dist = Math.sqrt(dist2); const force = (1 - dist / 220) * 0.035;
              p.vx += (dx / dist) * force; p.vy += (dy / dist) * force;
            }
          }
          p.vx *= 0.985; p.vy *= 0.985;
        }
      }
      function draw(isStatic = false) {
        ctx.clearRect(0, 0, cw, ch); ctx.globalCompositeOperation = 'lighter';
        for (let i = 0; i < particles.length; i++) {
          const a = particles[i];
          for (let j = i + 1; j < particles.length; j++) {
            const b = particles[j]; const dx = a.x - b.x; const dy = a.y - b.y; const d2 = dx * dx + dy * dy;
            if (d2 <= 22500) {
              const alpha = (1 - (Math.sqrt(d2) / 150)) * 0.12;
              ctx.strokeStyle = `rgba(255,255,255,${alpha})`; ctx.lineWidth = 1; ctx.beginPath(); ctx.moveTo(a.x, a.y); ctx.lineTo(b.x, b.y); ctx.stroke();
            }
          }
        }
        for (const p of particles) { ctx.fillStyle = `rgba(255,255,255,0.55)`; ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2); ctx.fill(); }
        ctx.globalCompositeOperation = 'source-over';
        if (!reduceMotion && !isStatic) step();
      }
      function loop() { draw(false); raf = requestAnimationFrame(loop); }
      window.addEventListener('resize', () => { cancelAnimationFrame(raf); resize(); if (!reduceMotion) loop(); }, {passive:true});
      window.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; mouse.active = true; });
      resize(); if (!reduceMotion) loop();
    })();
  </script>

  <script src="tm-loader.js"></script>
  <script type="module" src="preferences.js?v=3"></script>
</body>
</html>

